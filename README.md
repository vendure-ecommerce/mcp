# Vendure MCP Server

A standalone Model Context Protocol (MCP) server for Vendure CLI orchestration. This package runs on a per-project basis, allowing external clients like Cursor to interact with your local Vendure project's CLI commands in a programmatic and context-aware way.

## Features

- **Deep Project Integration**: Operates directly within your Vendure project, providing context-aware tooling.
- **CLI Integration**: Direct access to Vendure CLI `add` and `migrate` commands.
- **Project Analysis**: Analyze project structure, list plugins, entities, and services.
- **Dual Transport Support**: Connect via standard I/O (STDIO) for local clients like Cursor or via HTTP for networked clients.
- **Environment Check**: Verify Vendure installation and dependencies within the project.
- **Real-time**: Works with any local Vendure project without modification.

## Installation and Setup Workflow

The server is designed to be installed and run directly from your Vendure project. This ensures it always has access to the correct dependencies and project context.

### Step 1: Install in Your Vendure Project

Navigate to your Vendure project's root directory and install the server as a development dependency:

```bash
# In your Vendure project's root directory
npm install @vendure/mcp-server --save-dev
```

### Step 2: Configure Your MCP Client (e.g., Cursor)

Create or update the `mcp.json` file used by your MCP client. This file is typically located at `.cursor/mcp.json` inside your project's root folder.

Below are configurations for both STDIO and HTTP connections.

#### Option 1: STDIO Connection (Recommended for Local Clients)

This is the simplest and most direct way to connect.

```json
{
  "mcpServers": {
    "vendure": {
      "command": "npx",
      "args": [
        "--package",
        "@vendure/mcp-server",
        "vendure-mcp",
        "--projectPath",
        "/path/to/your/vendure-project"
      ]
    }
  }
}
```
**Note**: You must replace `/path/to/your/vendure-project` with the **absolute path** to your Vendure project's root directory.

#### Option 2: HTTP Connection

If your client does not support STDIO or you need to connect over a network, you can run the server in HTTP mode.

First, start the server from your terminal:
```bash
# In your Vendure project's root directory
npx vendure-mcp --transport http --projectPath .
```
This will start the server on the default port (8000).

Then, configure your `mcp.json` to connect to the running server's URL:
```json
{
  "mcpServers": {
    "vendure": {
      "command": "http://localhost:8000/mcp"
    }
  }
}
```

## Dynamic CLI Integration
The server dynamically generates MCP tools from your project's installed Vendure CLI command definitions. This ensures:
- **Single Source of Truth**: CLI changes automatically reflect in MCP tools.
- **Type Safety**: Full TypeScript integration with proper parameter validation.
- **Future-proof**: New CLI commands and options become available automatically.
- **No Hallucinations**: The code generated by the tools will always be correct, as it's based on the actual CLI definitions in your project.

## Development

If you are contributing to the `vendure-mcp-server` itself, you'll want to run it from the source code.

### Build from Source
```bash
git clone https://github.com/vendure-ecommerce/mcp.git
cd vendure-mcp-server # Or the correct directory name
npm install
npm run build
```

### Development Mode
To connect an MCP client to your local development server, use the `npm run dev` script and point it to a test Vendure project. You can run it in either STDIO or HTTP mode.

- **STDIO Mode**: `npm run dev -- --projectPath /path/to/your/test-vendure-project`
- **HTTP Mode**: `npm run dev:http -- --projectPath /path/to/your/test-vendure-project`

Configure your `mcp.json` as described in the setup section to connect to your development server. The `--` is required to pass arguments to the npm script correctly.

## Error Handling

Comprehensive error handling includes:
-   Project path validation.
-   Vendure CLI availability checks.
-   Parameter validation with detailed messages.
-   CLI execution error forwarding.
-   File system operation safety.

## Security

-   **Path validation**: Prevents directory traversal attacks.
-   **Input sanitization**: All parameters validated against schemas.
-   **Isolated execution**: Commands run in the specified project directory only.
-   **No elevated privileges**: Runs with standard user permissions.

## Links

-   [Vendure Core](https://github.com/vendure-ecommerce/vendure)
-   [Vendure Documentation](https://www.vendure.io/docs/)
-   [MCP Specification](https://spec.modelcontextprotocol.io/)
-   [GitHub Repository](https://github.com/vendure-ecommerce/mcp)